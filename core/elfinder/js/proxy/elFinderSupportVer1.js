window.elFinderSupportVer1=function(k){var l=this;this.upload=k||"auto";this.init=function(a){this.fm=a;this.fm.parseUploadData=function(a){var d;if(!$.trim(a))return{error:["errResponse","errDataEmpty"]};try{d=$.parseJSON(a)}catch(c){return{error:["errResponse","errDataNotJSON"]}}return l.normalize("upload",d)}};this.send=function(a){var b=this,d=this.fm,c=$.Deferred(),g=a.data.cmd,h={},e,f;c.abort=function(){"pending"==f.state()&&f.abort()};switch(g){case"open":a.data.tree=1;break;case"parents":case"tree":return c.resolve({tree:[]});case"get":a.data.cmd="read";a.data.current=d.file(a.data.target).phash;break;case"put":a.data.cmd="edit";a.data.current=d.file(a.data.target).phash;break;case"archive":case"rm":a.data.current=d.file(a.data.targets[0]).phash;break;case"extract":case"rename":case"resize":a.data.current=d.file(a.data.target).phash;break;case"duplicate":return h=$.extend(!0,{},a),$.each(a.data.targets,function(a,c){$.ajax($.extend(h,{data:{cmd:"duplicate",target:c,current:d.file(c).phash}})).error(function(a){d.error(d.res("error","connect"))}).done(function(a){a=b.normalize("duplicate",a);a.error?d.error(a.error):a.added&&d.trigger("add",{added:a.added})})}),c.resolve({});case"mkdir":case"mkfile":a.data.current=a.data.target;break;case"paste":a.data.current=a.data.dst;break;case"size":return c.resolve({error:d.res("error","cmdsupport")});case"search":return c.resolve({error:d.res("error","cmdsupport")});case"file":a.data.cmd="open",a.data.current=d.file(a.data.target).phash}f=$.ajax(a).fail(function(a){c.reject(a)}).done(function(a){e=b.normalize(g,a);"paste"!=g||e.error?c.resolve(e):(d.sync(),c.resolve({}))});return c};this.normalize=function(a,b){var d=this,c=this.fm,g={},h=function(a){return a&&a.hash&&a.name&&a.mime?a:null},e,f;if("tmb"==a||"get"==a)return b;"upload"==a&&b.error&&b.cwd&&(b.warning=$.extend({},b.error),b.error=!1);if(b.error)return b;if("put"==a)return e=c.file(b.target.hash).phash,{changed:[this.normalizeFile(b.target,e)]};e=b.cwd.hash;f=e==c.cwd().hash;b.tree&&$.each(this.normalizeTree(b.tree),function(a,b){g[b.hash]=b});$.each(b.cdc||[],function(a,c){var f=c.hash;g[f]?(g[f].date=c.date,g[f].locked=c.hash==e?!0:void 0===c.rm?!1:!c.rm):g[f]=d.normalizeFile(c,e,b.tmb)});b.tree||$.each(c.files(),function(a,b){g[a]||b.phash==e||"directory"!=b.mime||(g[a]=b)});if("open"==a)return{cwd:g[e]||this.normalizeFile(b.cwd),files:$.map(g,function(a){return a}),options:d.normalizeOptions(b),init:!!b.params,debug:b.debug};c=f?c.diff($.map(g,h)):{added:$.map(g,h)};return $.extend({current:b.cwd.hash,error:b.error,warning:b.warning,options:{tmb:!!b.tmb}},c)};this.normalizeTree=function(a){var b=this,d=[],c=function(a,h){var e,f;for(e=0;e<a.length;e++)f=a[e],d.push(b.normalizeFile(f,h)),f.dirs.length&&c(f.dirs,f.hash)};c([a]);return d};this.normalizeFile=function(a,b,d){var c=a.mime||"directory";b={url:a.url,hash:a.hash,phash:b,name:a.name,mime:c,date:a.date||"unknown",size:"directory"!=c||a.linkTo?a.size:0,read:a.read,write:a.write,locked:b?void 0===a.rm?!1:!a.rm:!0};if("application/x-empty"==a.mime||"inode/x-empty"==a.mime)b.mime="text/plain";a.linkTo&&(b.alias=a.linkTo);a.linkTo&&(b.linkTo=a.linkTo);a.tmb?b.tmb=a.tmb:0===b.mime.indexOf("image/")&&d&&(b.tmb=1);a.dirs&&a.dirs.length&&(b.dirs=!0);a.dim&&(b.dim=a.dim);a.resize&&(b.resize=a.resize);return b};this.normalizeOptions=function(a){var b={path:a.cwd.rel,disabled:$.merge(a.disabled||[],["search","netmount","zipdl"]),tmb:!!a.tmb,copyOverwrite:!0};a.params&&(b.api=1,b.url=a.params.url,b.archivers={create:a.params.archives||[],extract:a.params.extract||[]});-1!==b.path.indexOf("/")?b.separator="/":-1!==b.path.indexOf("\\")&&(b.separator="\\");return b}};